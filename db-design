CREATE TABLE IF NOT EXISTS attendees (
  id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  name VARCHAR(200) NOT NULL,
  nickname VARCHAR(200) NOT NULL,
  ticket VARCHAR(8) NOT NULL,
  PRIMARY KEY (id),
  UNIQUE(ticket)
) ENGINE=INNODB DEFAULT CHARACTER SET utf8;

CREATE TABLE IF NOT EXISTS checkins (
  id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  attendees_id INTEGER UNSIGNED NOT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT NOW(),
  PRIMARY KEY (id),
  FOREIGN KEY (attendees_id) REFERENCES attendees (id)
) ENGINE=INNODB DEFAULT CHARACTER SET utf8;

CREATE TABLE IF NOT EXISTS flags (
  id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  name VARCHAR(100),
  PRIMARY KEY (id),
  UNIQUE (name)
) ENGINE=INNODB DEFAULT CHARACTER SET utf8;

CREATE TABLE IF NOT EXISTS attendees_flags (
  id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  attendees_id INTEGER UNSIGNED NOT NULL,
  flags_id INTEGER UNSIGNED NOT NULL,
  PRIMARY KEY (id),
  UNIQUE (attendees_id, flags_id),
  FOREIGN KEY (attendees_id) REFERENCES attendees (id),
  FOREIGN KEY (flags_id) REFERENCES attributes (id)
) ENGINE=INNODB DEFAULT CHARACTER SET utf8;

CREATE TABLE IF NOT EXISTS flags (
  id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  name VARCHAR(100),
  PRIMARY KEY (id)
  UNIQUE (name)
) ENGINE=INNODB DEFAULT CHARACTER SET utf8;

CREATE TABLE IF NOT EXISTS attendees_extras (
  id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  attendees_id INTEGER UNSIGNED NOT NULL,
  extras_id INTEGER UNSIGNED NOT NULL,
  quantity INTEGER UNSIGNED NOT NULL,
  type VARCHAR(200),
  PRIMARY KEY (id),
  FOREIGN KEY (attendees_id) REFERENCES attendees (id),
  FOREIGN KEY (extras_id) REFERENCES extras (id)
) ENGINE=INNODB DEFAULT CHARACTER SET utf8;

ATTENDEES: <name>,<nickname>,<ticket>,<flag>,<flag>,...
           TEXT   TEXT       INT      TEXT   TEXT

ATTENDEES_EXTRAS: <name>,<ticket>,<quantity>,<type>
                  TEXT   INT      INT        TEXT
